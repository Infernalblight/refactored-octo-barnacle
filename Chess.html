<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chess</title>
<style>
body{
margin:0;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
background:#111;
}
#game{
display:flex;
flex-direction:column;
align-items:center;
gap:10px;
}
#turn{
color:white;
font-family:sans-serif;
font-size:18px;
}
#board{
display:grid;
grid-template-columns:repeat(8,70px);
grid-template-rows:repeat(8,70px);
border:4px solid #555;
}
.square{
width:70px;
height:70px;
display:flex;
justify-content:center;
align-items:center;
font-size:42px;
cursor:pointer;
user-select:none;
}
.white{background:#eee}
.black{background:#444;color:white}
.selected{outline:3px solid red}
.move{outline:3px solid lime}
</style>
</head>
<body>
<div id="game">
<div id="turn">Turn: White</div>
<div id="board"></div>
</div>

<audio id="moveSound" src="/SFX/chess/chess.mp3"></audio>

<script>
const boardEl=document.getElementById("board")
const turnEl=document.getElementById("turn")
const moveSound=document.getElementById("moveSound")

let turn="white"
let selected=null
let legalMoves=[]

let board=[
["br","bn","bb","bq","bk","bb","bn","br"],
["bp","bp","bp","bp","bp","bp","bp","bp"],
["","","","","","","",""],
["","","","","","","",""],
["","","","","","","",""],
["","","","","","","",""],
["wp","wp","wp","wp","wp","wp","wp","wp"],
["wr","wn","wb","wq","wk","wb","wn","wr"]
]

function draw(){
boardEl.innerHTML=""
for(let r=0;r<8;r++){
for(let c=0;c<8;c++){
const sq=document.createElement("div")
sq.className="square "+((r+c)%2?"black":"white")
sq.textContent=pieceChar(board[r][c])
if(selected&&selected.r===r&&selected.c===c) sq.classList.add("selected")
if(legalMoves.some(m=>m.r===r&&m.c===c)) sq.classList.add("move")
sq.onclick=()=>click(r,c)
boardEl.appendChild(sq)
}
}
}

function pieceChar(p){
const map={
wp:"♙",wr:"♖",wn:"♘",wb:"♗",wq:"♕",wk:"♔",
bp:"♟",br:"♜",bn:"♞",bb:"♝",bq:"♛",bk:"♚"
}
return map[p]||""
}

function click(r,c){
if(selected){
for(let m of legalMoves){
if(m.r===r&&m.c===c){
if(board[r][c]&&board[r][c][1]==="k"){
alert((turn==="white"?"White":"Black")+" wins")
location.reload()
return
}
board[r][c]=board[selected.r][selected.c]
board[selected.r][selected.c]=""
selected=null
legalMoves=[]
moveSound.currentTime=0
moveSound.play()
turn=turn==="white"?"black":"white"
turnEl.textContent="Turn: "+(turn==="white"?"White":"Black")
draw()
return
}
}
}
if(board[r][c]&&board[r][c][0]===turn[0]){
selected={r,c}
legalMoves=getLegalMoves(r,c)
draw()
}else{
selected=null
legalMoves=[]
draw()
}
}

function getLegalMoves(r,c){
let raw=getMoves(r,c)
let safe=[]
for(let m of raw){
let copy=JSON.parse(JSON.stringify(board))
copy[m.r][m.c]=copy[r][c]
copy[r][c]=""
if(!inCheck(copy,board[r][c][0])) safe.push(m)
}
return safe
}

function inCheck(b,color){
let kr,kc
for(let r=0;r<8;r++){
for(let c=0;c<8;c++){
if(b[r][c]===color+"k"){kr=r;kc=c}
}
}
for(let r=0;r<8;r++){
for(let c=0;c<8;c++){
if(b[r][c]&&b[r][c][0]!==color){
let moves=getMoves(r,c,b)
if(moves.some(m=>m.r===kr&&m.c===kc)) return true
}
}
}
return false
}

function getMoves(r,c,b=board){
const p=b[r][c]
if(!p) return []
const color=p[0]
const type=p[1]
let m=[]
const dir=color==="w"?-1:1

if(type==="p"){
if(inBounds(r+dir,c)&&!b[r+dir][c]) m.push({r:r+dir,c})
if((color==="w"&&r===6)||(color==="b"&&r===1)){
if(!b[r+dir][c]&&!b[r+2*dir][c]) m.push({r:r+2*dir,c})
}
for(let dc of [-1,1]){
let nr=r+dir,nc=c+dc
if(inBounds(nr,nc)&&b[nr][nc]&&b[nr][nc][0]!==color) m.push({r:nr,c:nc})
}
}

if(type==="r"||type==="q") lineMoves(r,c,color,[[1,0],[-1,0],[0,1],[0,-1]],m,b)
if(type==="b"||type==="q") lineMoves(r,c,color,[[1,1],[1,-1],[-1,1],[-1,-1]],m,b)

if(type==="n"){
for(let [dr,dc] of [[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]]){
let nr=r+dr,nc=c+dc
if(inBounds(nr,nc)&&(!b[nr][nc]||b[nr][nc][0]!==color)) m.push({r:nr,c:nc})
}
}

if(type==="k"){
for(let dr=-1;dr<=1;dr++){
for(let dc=-1;dc<=1;dc++){
if(dr||dc){
let nr=r+dr,nc=c+dc
if(inBounds(nr,nc)&&(!b[nr][nc]||b[nr][nc][0]!==color)) m.push({r:nr,c:nc})
}
}
}
}

return m
}

function lineMoves(r,c,color,dirs,m,b){
for(let [dr,dc] of dirs){
let nr=r+dr,nc=c+dc
while(inBounds(nr,nc)){
if(!b[nr][nc]){
m.push({r:nr,c:nc})
}else{
if(b[nr][nc][0]!==color) m.push({r:nr,c:nc})
break
}
nr+=dr
nc+=dc
}
}
}

function inBounds(r,c){
return r>=0&&r<8&&c>=0&&c<8
}

draw()
</script>
</body>
</html>
