<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Cloud</title>
<style>
body{margin:0;font-family:system-ui;background:#0b0f19;color:#e5e7eb}
.app{display:flex;height:100vh}
.sidebar{width:260px;background:#020617;padding:10px;overflow:auto}
.main{flex:1;padding:10px}
.item{cursor:pointer;padding:4px 8px;border-radius:6px}
.item:hover{background:#1e293b}
.file{color:#e5e7eb}
.dir{color:#38bdf8;font-weight:600}
.top{display:flex;gap:8px;margin-bottom:10px}
input,button{background:#020617;border:1px solid #1e293b;color:#e5e7eb;padding:8px;border-radius:8px}
</style>
</head>
<body>
<div class="app">
  <div class="sidebar" id="tree"></div>
  <div class="main">
    <div class="top">
      <input type="password" id="pw" placeholder="Password">
      <input type="file" id="file" webkitdirectory multiple>
      <button onclick="upload()">Upload</button>
    </div>
    <div id="files"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script>
const BACKEND = "https://horizon-clause-looking-extended.trycloudflare.com"

function headers(){
  return { "x-password": document.getElementById("pw").value }
}

async function upload(){
  const input = document.getElementById("file")
  if (!input.files.length) return

  const file = input.files[0]

  if (file.type === "application/zip" || file.name.endsWith(".zip")) {
    uploadFile(file)
  } else {
    alert("Only ZIP files or folders are allowed")
  }
}

async function uploadFolder(files){
  const zip = new JSZip()
  for (const f of files) {
    zip.file(f.webkitRelativePath || f.name, f)
  }
  const blob = await zip.generateAsync({ type: "blob" })
  const zipped = new File([blob], "folder.zip", { type: "application/zip" })
  uploadFile(zipped)
}

function uploadFile(file){
  const fd = new FormData()
  fd.append("file", file)

  fetch(BACKEND + "/upload", {
    method: "POST",
    headers: headers(),
    body: fd
  })
  .then(r => r.json())
  .then(d => alert("Uploaded: " + d.uploaded))
}

function onPick(e){
  const files = e.target.files
  if (files.length > 1) {
    uploadFolder(files)
  } else {
    upload()
  }
}
</script>
</body>
</html>
