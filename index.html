<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Cloud</title>
<style>
body{margin:0;font-family:system-ui;background:#0b0f19;color:#e5e7eb}
.app{display:flex;height:100vh}
.sidebar{width:260px;background:#020617;padding:10px;overflow:auto}
.main{flex:1;padding:10px}
.item{cursor:pointer;padding:4px 8px;border-radius:6px}
.item:hover{background:#1e293b}
.file{color:#e5e7eb}
.dir{color:#38bdf8;font-weight:600}
.top{display:flex;gap:8px;margin-bottom:10px}
input,button{background:#020617;border:1px solid #1e293b;color:#e5e7eb;padding:8px;border-radius:8px}
</style>
</head>
<body>
<div class="app">
  <div class="sidebar" id="tree"></div>
  <div class="main">
    <div class="top">
      <input type="password" id="pw" placeholder="Password">
      <input type="file" id="file" webkitdirectory multiple>
      <button onclick="upload()">Upload</button>
    </div>
    <div id="files"></div>
  </div>
</div>

<script>
const BACKEND="https://edited-estimate-accessory-painted.trycloudflare.com"
let current=""

function h(){return{"x-password":pw.value,"x-path":current}}

function render(list, el){
  list.forEach(i=>{
    const d=document.createElement("div")
    d.className="item "+i.type
    d.textContent=i.name
    if(i.type==="dir"){
      d.onclick=()=>{current=i.path;load()}
      el.appendChild(d)
      const sub=document.createElement("div")
      sub.style.paddingLeft="12px"
      el.appendChild(sub)
      render(i.children,sub)
    }else{
      d.onclick=()=>{
        fetch(BACKEND+"/download?path="+encodeURIComponent(i.path),{headers:h()})
        .then(r=>r.blob()).then(b=>{
          const u=URL.createObjectURL(b)
          const a=document.createElement("a")
          a.href=u;a.download=i.name;a.click()
          URL.revokeObjectURL(u)
        })
      }
      el.appendChild(d)
    }
  })
}

function load(){
  fetch(BACKEND+"/files",{headers:h()})
  .then(r=>r.json())
  .then(d=>{
    tree.innerHTML=""
    render(d,tree)
  })
}

function upload(){
  const fd=new FormData()
  for(const f of file.files){
    fd.append("files",f,f.webkitRelativePath||f.name)
  }
  fetch(BACKEND+"/upload",{method:"POST",headers:{"x-password":pw.value,"x-path":current},body:fd})
  .then(()=>load())
}

load()
</script>
</body>
</html>
